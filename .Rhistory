TRUE ~ azul_claro),
tipo_valor = factor(tipo_valor,
levels = c("valor_de_verdade", "em_branco")),
variavel = factor(variavel, levels = rev(c("dc", "ded", "dcl"))),
medias = replace(medias, medias == "media_regiao", "Média da Região"),
medias = replace(medias, medias == "media_nacional", "Média Nacional"))
}
plota_card_estado <- function(dados) {
ggplot(dados, aes(x = variavel, y = valor, fill = cores)) +
geom_col(position = "stack", width = 0.5) +
geom_tile(aes(y = valor_media), color = azul, width = 0.7, height = 1, linetype = "dotted") +
geom_text(aes(y = valor_media,
label = paste0(medias, "\nR$ ",
format(round(valor_media/1e9, 2), big.mark = ".", decimal.mark = ","), " bi"),
vjust = ifelse(medias == "Média Nacional", 2.7, -1.9)), family = "Open Sans Condensed",
size = 3.5, color = "dimgrey", hjust = "inward") +
geom_label(aes(label = ifelse(tipo_valor == "valor_de_verdade" & medias == "Média da Região",
paste0("R$ ", format(round(valor/1e9, 2),
big.mark = ".",
decimal.mark = ","),
" bi"),
NA),
y = valor,
color = cores),
family = "Open Sans", size = 3.5, hjust = "center",
position = "stack", vjust = "center", fill = "white") +
scale_fill_identity() +
scale_color_identity() +
scale_y_continuous(labels=function(x) {format(x/1e9, big.mark = ".", decimal.mark=",", scientific = FALSE)}, expand = expand_scale(mult = c(.05, .1))) +
scale_x_discrete(labels = c("ded" = "Deduções",
"dc"  = "Dívida\nConsolidada",
"dcl" = "Dívida\nConsolidada\nLíquida")) +
labs(x = NULL, y = "R$ bilhões") +
coord_flip() +
tema() + theme(axis.text.y = element_text(size = 12)) + theme(axis.line.x = element_line())
}
mapa_brasil <- geojsonio::geojson_read("./dados/brazil_geo.geojson", what = "sp")
# testando esse simplify
mapa_brasil <- rmapshaper::ms_simplify(mapa_brasil)
mapa_brasil@data <- sumario_estados %>%
select(UF, REGIAO, pct_DCL_RCL) %>%
right_join(mapa_brasil@data, by = c("UF" = "sigla"))
mapa_brasil@data <- mapa_brasil@data %>%
left_join(estados)
bins <- c(-20, 0, 20, 40, 60, 80, 100, 200, Inf)
pal <- colorBin("YlOrRd", domain = mapa_brasil$DCL, bins = bins)
labels <- sprintf(
"<strong>%s</strong><br/>DCL/RCL: %g &#37;",
mapa_brasil$nomes, mapa_brasil$pct_DCL_RCL
) %>% lapply(htmltools::HTML)
faz_mapa <- function() {
leaflet(mapa_brasil, options = leafletOptions(minZoom = 3.7, maxZoom = 4.5, dragging = FALSE)) %>%
setView(lat=-14.235, lng=-51.9253 , zoom=4.5) %>%
addPolygons(
fillColor = ~pal(pct_DCL_RCL),
weight = 3,
opacity = 1,
color = "white",
fillOpacity = 0.8,
highlight = highlightOptions(
weight = 3,
color = "#353E57",
fillOpacity = 1,
bringToFront = TRUE),
label = labels,
layerId = ~UF,  # muito importante, vai alimentar o "id" do shape_click
labelOptions = labelOptions(
style = list("font-weight" = "normal",
"font-family" = "'Open Sans'",
padding = "3px 8px"),
textsize = "15px",
direction = "auto"))
}